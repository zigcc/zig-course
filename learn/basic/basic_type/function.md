---
outline: deep
---

# å‡½æ•°

> å‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æœ€ä¸ºåŸºæœ¬çš„è¯­å¥ã€‚

## åŸºæœ¬ä½¿ç”¨

zig çš„å‡½æ•°æ˜æ˜¾ï¼Œä½ å¯ä»¥ä¸€çœ¼å°±çœ‹å‡ºæ¥å®ƒçš„ç»„æˆï¼Œæˆ‘ä»¬æ¥ç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°ä½œä¸ºè¯´æ˜ï¼š

```zig
pub fn add(a: u8, b: u8) u8 {
    return a + b;
}
```

> å¦‚æœä½ æœ‰ C++ çš„ä½¿ç”¨ç»éªŒï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºæ¥å„è‡ªçš„ä½œç”¨ã€‚

ä¸‹é¢æ¥è¿›è¡Œè¯´æ˜ï¼š

1. `pub` æ˜¯è®¿é—®ä¿®é¥°ç¬¦ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªé€‰æ‹©ï¼Œé‚£å°±æ˜¯ `pub`ï¼Œè¿™ä»£è¡¨ç€å‡½æ•°æ˜¯å…¬å…±å¯è®¿é—®çš„ï¼ˆå…¶ä»–çš„æ–‡ä»¶importè¯¥æ–‡ä»¶åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼‰ã€‚
2. `fn` æ˜¯å…³é”®å­—ï¼Œä»£è¡¨ç€æˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ã€‚
3. `add` æ˜¯æ ‡è¯†ç¬¦ï¼Œä½œä¸ºå‡½æ•°çš„åå­—ã€‚
4. `a: u8` æ˜¯å‚æ•°çš„æ ‡è¯†ç¬¦å’Œç±»å‹ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ `a` å’Œ `b`ï¼Œå®ƒä»¬çš„ç±»å‹å‡æ˜¯ `u8`ã€‚
5. `u8` æ˜¯å‡½æ•°çš„è¿”å›ç±»å‹ï¼Œåœ¨ zig ä¸­ï¼Œä¸€ä¸ªå‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ã€‚

å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œè¯·ä½¿ç”¨ `void`ã€‚

:::info ğŸ…¿ï¸ æç¤º

ä½ å¯èƒ½æ³¨æ„åˆ°äº†æœ‰çš„å‡½æ•°å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š

```zig
fn max(comptime T: type, a: T, b: T) T {
    return if (a > b) a else b;
}
```

å…¶ä¸­çš„ `comptime T: type` ä½ å¯èƒ½å¾ˆé™Œç”Ÿï¼Œè¿™æ˜¯ç¼–è¯‘æœŸå‚æ•°ï¼Œå®ƒæ˜¯ç”¨æ¥å®ç°é¸­å­ç±»å‹ï¼ˆæ³›å‹ï¼‰çš„å…³é”®è¯­æ³•ï¼

:::

:::details å…³äºå‡½æ•°å‘½å

è¿™é‡Œå‘½åè§„åˆ™æ²¡ä»€ä¹ˆå¼ºåˆ¶æ€§çš„è¦æ±‚ï¼Œä½ åªéœ€è¦ä¿è¯ç¬¦åˆå˜é‡å£°æ˜çš„ [_æ ‡è¯†ç¬¦è§„èŒƒ_](/basic/define-variable.html#æ ‡è¯†ç¬¦å‘½å) å³å¯ã€‚

å¦‚æœä½ éœ€è¦ä¸€ä¸ªå‘½åçš„æ¨èè§„åˆ™çš„è¯ï¼Œå¯ä»¥å‚ç…§ zig æºç çš„å‘½åæ–¹å¼ï¼Œå®ƒä½¿ç”¨çš„æ˜¯[å°é©¼å³°å‘½åæ³•](#)ã€‚

:::

::: warning

å‡½æ•°ä½“å’Œå‡½æ•°æŒ‡é’ˆä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå‡½æ•°ä½“æ˜¯ä»…é™ç¼–è¯‘æ—¶çš„ç±»å‹ï¼Œè€Œå‡½æ•°æŒ‡é’ˆå¯èƒ½æ˜¯è¿è¡Œæ—¶å·²çŸ¥çš„ã€‚

å…³äºå‡½æ•°æŒ‡é’ˆï¼Œ`*const fn (a: i8, b: i8) i8` å°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç±»å‹ã€‚

:::

## å‚æ•°ä¼ é€’

> å‚æ•°ä¼ é€’æ˜¯ä¸€ä¸ªéå¸¸å¤è€çš„é—®é¢˜ï¼Œåœ¨é«˜çº§è¯­è¨€çš„è§’åº¦æ¥çœ‹ï¼Œå­˜åœ¨ç€â€œå€¼ä¼ é€’â€å’Œâ€œå¼•ç”¨ä¼ é€’â€è¿™ä¸¤ç§æƒ…å†µï¼Œè¿™æ— ç–‘å¤§å¤§å¢åŠ äº†ç¨‹åºå‘˜åœ¨ç¼–ç¨‹æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚

zig åœ¨è¿™æ–¹é¢çš„å¤„ç†åˆ™æ˜¯ï¼ŒåŸå§‹ç±»å‹ï¼ˆæ•´å‹ã€å¸ƒå°”è¿™ç§ï¼‰ä¼ é€’å®Œå…¨ä½¿ç”¨å€¼ä¼ é€’ï¼Œé’ˆå¯¹åŸå§‹ç±»å‹çš„è¿™ç§ç­–ç•¥å¼€é”€éå¸¸å°ï¼Œé€šå¸¸åªéœ€è¦è®¾ç½®å¯¹åº”çš„å¯„å­˜å™¨å³å¯ã€‚

åƒå¤åˆç±»å‹ï¼ˆç»“æ„ä½“ã€è”åˆã€æ•°ç»„ç­‰ï¼‰ï¼Œè¿™äº›ä¼ é€’å‡æ˜¯ç”±ç¼–è¯‘å™¨æ¥å†³å®šç©¶ç«Ÿæ˜¯ä½¿ç”¨â€œå€¼ä¼ é€’â€è¿˜æ˜¯â€œå¼•ç”¨ä¼ é€’â€ã€‚

ä½†ä½œä¸ºå¼€å‘è€…ï¼Œåªéœ€è¦è®°ä½ï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ä¸å¯å˜çš„å°±è¡Œäº†ã€‚

:::info ğŸ…¿ï¸ æç¤º

å¯¹äºå¤–éƒ¨å‡½æ•°(ä½¿ç”¨ `extern` ä¿®é¥°)ï¼ŒZig éµå¾ª C ABI æŒ‰å€¼ä¼ é€’ç»“æ„å’Œè”åˆç±»å‹ã€‚

:::

## é«˜é˜¶ä½¿ç”¨

### `anytype`

å‡½æ•°å‚æ•°å¯ä»¥ç”¨ `anytype` ä»£æ›¿ç±»å‹æ¥å£°æ˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨å‡½æ•°æ—¶å°†æ¨æ–­å‚æ•°ç±»å‹ã€‚ä½¿ç”¨ `@TypeOf` å’Œ `@typeInfo` è·å–æœ‰å…³æ¨æ–­ç±»å‹çš„ä¿¡æ¯ã€‚

```zig
fn addFortyTwo(x: anytype) @TypeOf(x) {
    return x + 42;
}
```

### `noreturn`

`noteturn` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒä»£è¡¨ä»¥ä¸‹å†…å®¹ï¼š

- `break`
- `continue`
- `return`
- `unreachable`
- `while (true) {}`

å½“ä¸€ä¸ªå‡½æ•°ä¸ä¼šè¿”å›æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ä»£æ›¿ `void`ã€‚

è¯¥ç±»å‹ä¸€èˆ¬ç”¨åœ¨å†…æ ¸å¼€å‘ä¸­ï¼Œå› ä¸ºå†…æ ¸æœ¬èº«åº”å½“æ˜¯ä¸€ä¸ªä¸ä¼šé€€å‡ºçš„ç¨‹åºï¼Œè¿˜æœ‰ä¸€ç§ä½¿ç”¨åœºæ™¯æ˜¯ `exit` å‡½æ•°ã€‚

```zig
extern "kernel32" fn ExitProcess(exit_code: c_uint) callconv(WINAPI) noreturn;
```

### `extern`

`extern` å…³é”®å­—ä¿è¯å‡½æ•°å¯ä»¥åœ¨ç”Ÿæˆçš„ object æ–‡ä»¶ä¸­å¯è§ï¼Œå¹¶ä¸”ä½¿ç”¨ C ABIã€‚

```zig
export fn sub(a: i8, b: i8) i8 { return a - b; }
```

::: info ğŸ…¿ï¸ æç¤º

extern å…³é”®å­—åé¢å¸¦å¼•å·çš„æ ‡è¯†ç¬¦æŒ‡å®šå…·æœ‰è¯¥å‡½æ•°çš„åº“ï¼Œä¾‹å¦‚ `c` -> `libc.so`ï¼Œ`callconv` è¯´æ˜ç¬¦æ›´æ”¹å‡½æ•°çš„è°ƒç”¨çº¦å®šã€‚

```zig
extern "c" fn atan2(a: f64, b: f64) f64;
```

:::

### `@setCode`

`@setCold(comptime is_cold: bool) void`

å‘Šè¯‰ä¼˜åŒ–å™¨å½“å‰å‡½æ•°å¾ˆå°‘è¢«è°ƒç”¨ï¼ˆæˆ–ä¸è¢«è°ƒç”¨ï¼‰ï¼Œè¯¥å‡½æ•°ä»…åœ¨å‡½æ•°ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚

```zig
fn abort() noreturn {
    @setCold(true);
    while (true) {}
}
```

### `callconv`

`callconv` å…³é”®å­—å‘Šè¯‰å‡½æ•°çš„è°ƒç”¨çº¦å®šï¼Œè¿™åœ¨å¯¹å¤–æš´æ¼å‡½æ•°æˆ–è€…è£¸æ±‡ç¼–æ—¶ä¼šå¾ˆæœ‰ç”¨ã€‚

```zig
// å¼ºåˆ¶è¯¥å‡½æ•°åœ¨æ‰€æœ‰è¢«è°ƒç”¨ä½ç½®å†…è”ï¼Œå¦åˆ™å¤±è´¥ã€‚
fn shiftLeftOne(a: u32) callconv(.Inline) u32 {
    return a << 1;
}
```

å…³äºå¯ä»¥ä½¿ç”¨çš„è°ƒç”¨çº¦å®šæ ¼å¼ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œ[`std.builtin.CallingConvention`](https://ziglang.org/documentation/master/std/#A;std:builtin.CallingConvention)ã€‚
