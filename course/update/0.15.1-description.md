---
outline: deep
comments: false
showVersion: false
---

# `0.15.1`

2025/1/20，`0.15.1` 发布，历时 5 个月，有 162 位贡献者，一共进行了 647 次提交！

Zig 官方团队直接从 `0.14.0` 跨越到了 `0.15.1`。在默认选择 Zig 的 x86 后端后，调试编译速度提高了 5 倍；正在开发的 aarch64 后端也紧随其后。同时，Writergate 事件以及一系列语言变更和标准库的调整，带来了大量的 API 破坏性更改；这预示着 async/await 的复兴；也是语言稳定化的最后防线。

## 编译器重大改进

### x86 后端性能突破

**调试编译速度提高了 5 倍**，这是本次更新最显著的性能改进。x86 后端现在是默认选择，为快速开发周期提供了强有力的支持。

### aarch64 后端开发进展

aarch64 后端的开发也在稳步推进，持续改进 ARM 平台支持，为多架构开发提供更好的体验。

### 增量编译

增量编译功能得到了改进，支持：
- 与文件系统监视结合使用
- 仅检查编译错误模式
- 更快的重建速度

### 多线程代码生成

编译器现在支持多线程代码生成，可以充分利用多核 CPU 的性能。

## 语言特性重大调整

### 移除 `usingnamespace` 关键字

这是一个**破坏性更改**，`usingnamespace` 关键字被完全移除。所有使用 `usingnamespace` 的代码需要重写，推荐使用显式导入替代，提高代码可读性和维护性。

### 移除异步关键字

`async` 和 `await` 关键字被移除，当前异步编程模型被移除，为未来新的异步方案做准备。这预示着 async/await 的复兴。

### 对非穷尽枚举的 `switch` 支持

新增对非穷尽枚举使用 `switch` 语句的支持，提高枚举处理的灵活性，支持未知枚举值的处理，增强代码的健壮性。

### 允许对布尔向量使用更多运算符

布尔向量现在支持更多运算符，包括逻辑运算和比较运算。

### 内联汇编：类型化的破坏描述符

内联汇编现在支持类型化的 clobber 列表，提供更好的类型安全。

### 指针转换增强

`@ptrCast` 现在允许从单项指针到切片的转换，提供更大的灵活性。

### undefined 运算新规则

对 `undefined` 值的算术运算规则发生了变化，任何与 `undefined` 的运算都返回 `undefined`。

### 有损转换检测

现在对于可能导致精度损失的整数到浮点数转换会发出编译错误。

## 标准库重大变更

### Writergate：I/O 接口完全重构

这是本次更新中**最重大的破坏性更改**，被社区称为 "Writergate"：

- `std.io.Reader` 和 `std.io.Writer` 接口被完全重新设计
- 新接口采用非泛型设计
- 缓冲区位于接口之上
- 旨在提高性能并减少不必要的拷贝
- **需要大量代码重写**

### 格式化系统调整

格式化系统进行了重要调整：
- 调用自定义 `format` 方法需要使用 `{f}` 格式说明符
- `format` 方法签名简化，移除了格式字符串和选项参数
- 格式化打印不再处理 Unicode
- 新增了更多格式化说明符

### `ArrayList` 非托管化

容器类型的重要变更：
- `std.ArrayList` 现在默认采用非托管方式
- 开发者需要显式提供分配器
- 与其他非托管容器保持一致
- 提供更好的内存管理控制

### 去泛型化链表

链表类型进行了重构，去除了泛型化设计。

### HTTP 客户端和服务器

标准库新增了 HTTP 支持，提供内置的 HTTP 客户端和服务器功能。

### TLS 客户端

新增内置 TLS 支持，可以建立安全的 TLS 连接。

### 环形缓冲区

新增了环形缓冲区类型，提供高效的循环缓冲区实现。

### 移除 BoundedArray

`BoundedArray` 被移除，建议使用 `ArrayList` 或固定大小数组替代。

## 构建系统改进

### 移除隐式根模块

构建系统移除了对隐式根模块的支持，需要在构建脚本中明确指定模块，提高构建配置的明确性。

### macOS 文件系统监视

在 macOS 上新增了文件系统监视功能：
- 能够在文件更改时自动触发重建
- 支持 `--watch` 和 `--debounce` 选项
- 显著提高开发效率

### Web 界面和时间报告

构建系统现在支持 Web 界面和详细的时间报告功能。

## 模糊测试器

Zig 0.15.1 集成了一个内置的模糊测试器：
- 支持进程内模糊测试
- 提供 Web UI 界面
- 支持实时代码覆盖率显示
- 可以快速发现代码中的问题

## 工具链更新

### LLVM 20

升级到 LLVM 20，带来了：
- 更好的优化支持
- 新的目标架构支持
- 改进的调试信息生成
- 更好的 C++ 交互性

### FreeBSD 和 NetBSD libc 支持

在交叉编译时新增了对动态链接的 FreeBSD 和 NetBSD libc 的支持。

### glibc 2.42

升级到 glibc 2.42，并支持静态链接本机 glibc。

### MinGW-w64 更新

MinGW-w64 工具链得到了更新，改进了 Windows 交叉编译支持。

### zig libc 和 zig cc 增强

`zig libc` 和 `zig cc` 命令得到了功能增强：
- 更好的 GCC 兼容性
- 支持更多编译选项
- 更好的错误报告

## 版本跳跃说明

Zig 官方团队选择直接从 `0.14.0` 跳跃到 `0.15.1`，这反映了：
- 本次更新包含的重大变更数量
- 对编译器性能的重要改进
- 标准库接口的重大重构
- 为未来版本奠定更好的基础

## 升级挑战与机遇

### 主要挑战

1. **Writergate**：I/O 接口的完全重构需要重写大量相关代码
2. **移除 `usingnamespace`**：需要调整导入方式
3. **异步代码调整**：需要移除 async/await 使用
4. **ArrayList 变更**：需要调整容器使用方式

### 主要机遇

1. **编译速度提升**：5 倍的调试编译速度改进
2. **更清晰的代码**：移除隐式行为，提高代码可读性
3. **更好的性能**：新的 I/O 接口设计更高效
4. **开发效率**：文件系统监视功能和模糊测试器

## 社区影响

这次更新对 Zig 社区产生了重要影响：
- **学习曲线**：新用户需要适应新的接口设计
- **迁移工作**：现有项目需要进行大量调整
- **性能收益**：编译速度的显著提升改善开发体验
- **生态系统**：库作者需要更新以适配新接口

## 技术债务清理

本次更新体现了 Zig 团队对技术债务的积极清理：
- 移除了有争议的 `usingnamespace` 特性
- 重构了性能不佳的 I/O 接口
- 统一了容器类型的设计理念
- 为未来的语言演进奠定基础

## 未来展望

`0.15.1` 为 Zig 的未来发展奠定了重要基础：
- **编译性能**：为大型项目开发提供更好支持
- **接口设计**：更一致、更高效的标准库
- **开发体验**：更快的编译和更好的工具支持
- **语言稳定性**：移除不稳定特性，为 1.0 做准备

## 路线图

### I/O 作为接口

I/O 系统将继续作为接口进行发展和完善，为未来的异步编程模型做准备。

## 建议

对于 Zig 开发者：
1. **谨慎升级**：在测试环境中充分验证
2. **分步迁移**：逐步调整代码以适配新接口
3. **利用性能**：充分利用编译速度的改进
4. **关注社区**：参与社区讨论，分享迁移经验

`0.15.1` 是 Zig 发展历程中的一个重要里程碑，虽然带来了较多的破坏性更改，但为语言的长期发展和性能提升奠定了坚实的基础。这是语言稳定化的最后防线，为 1.0 版本的发布做好了准备。