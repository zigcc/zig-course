---
outline: deep
---

# æŒ‡é’ˆ

> ä½œä¸ºä¸€é—¨åº•å±‚è¯­è¨€ï¼ŒZig è‡ªç„¶æ”¯æŒæŒ‡é’ˆã€‚

æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå­˜å‚¨äº†å¦ä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€ã€‚é€šè¿‡æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥é—´æ¥è®¿é—®å’Œæ“ä½œå…¶æŒ‡å‘çš„å†…å­˜åŒºåŸŸã€‚

**å–åœ°å€**ï¼šé€šè¿‡ `&` ç¬¦å·æ¥è·å–æŸä¸ªå˜é‡æ‰€å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œå¦‚ `&integer` å°±æ˜¯è·å–å˜é‡ `integer` çš„å†…å­˜åœ°å€ã€‚

ä¸ C ä¸åŒï¼ŒZig å°†æŒ‡é’ˆåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå•é¡¹æŒ‡é’ˆå’Œå¤šé¡¹æŒ‡é’ˆã€‚è¿™ç§åŒºåˆ†ä¸»è¦æ˜¯ä¸ºäº†æ˜ç¡®æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å•ä¸ªå…ƒç´ è¿˜æ˜¯å¤šä¸ªå…ƒç´ ï¼Œä»è€Œæ›´å®‰å…¨ã€é«˜æ•ˆåœ°ä½¿ç”¨æŒ‡é’ˆã€‚ä¸‹å›¾å±•ç¤ºäº†å®ƒä»¬æŒ‡å‘å…ƒç´ çš„ä¸åŒï¼š

![pointer representation](/picture/basic/pointer-representation.svg)

:::info ğŸ…¿ï¸ æç¤º

ä¸Šå›¾ä¸­åŒ…å«äº†åˆ‡ç‰‡ï¼ˆsliceï¼‰ç±»å‹ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œåˆ‡ç‰‡ä¸æ˜¯æŒ‡é’ˆï¼Œä½†å®ƒå†…éƒ¨åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ˆé€šå¸¸è¢«ç§°ä¸ºâ€œèƒ–æŒ‡é’ˆâ€ï¼‰ï¼Œå¹¶ä¸”åœ¨å®é™…ç¼–ç ä¸­æ›´ä¸ºå¸¸ç”¨ï¼Œå› æ­¤åœ¨è¿™é‡Œä¸€å¹¶åˆ—å‡ºä»¥ä¾¿è¯»è€…æ¯”è¾ƒã€‚

:::

:::warning å…³äºæŒ‡é’ˆè¿ç®—

Zig æ”¯æŒæŒ‡é’ˆçš„åŠ å‡è¿ç®—ï¼Œä½†å»ºè®®åœ¨è¿›è¡Œè¿ç®—å‰ï¼Œå°†æŒ‡é’ˆè½¬æ¢ä¸º `[*]T` ç±»å‹ã€‚

å°¤å…¶æ˜¯åœ¨å¤„ç†åˆ‡ç‰‡æ—¶ï¼Œä¸åº”ç›´æ¥ä¿®æ”¹åˆ‡ç‰‡çš„å†…éƒ¨æŒ‡é’ˆï¼Œå› ä¸ºè¿™ä¼šç ´ååˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„ã€‚

:::

## å•é¡¹æŒ‡é’ˆ

å•é¡¹æŒ‡é’ˆæŒ‡å‘å•ä¸ªå…ƒç´ ã€‚

å•é¡¹æŒ‡é’ˆçš„ç±»å‹ä¸º `*T`ï¼Œå…¶ä¸­ `T` æ˜¯æ‰€æŒ‡å‘çš„æ•°æ®ç±»å‹ã€‚è§£å¼•ç”¨æ“ä½œä½¿ç”¨ `ptr.*`ã€‚

<<<@/code/release/pointer.zig#single_pointer

å•é¡¹æŒ‡é’ˆæœ¬èº«æ”¯æŒä»¥ä¸‹æ“ä½œï¼š

- è§£å¼•ç”¨è¯­æ³• `ptr.*`
- åˆ‡ç‰‡è¯­æ³• `ptr[0..1]`
- æŒ‡é’ˆå‡æ³• `ptr - ptr`

:::info ğŸ…¿ï¸ æç¤º

å‡½æ•°æŒ‡é’ˆç•¥æœ‰ç‰¹æ®Šï¼š

<<<@/code/release/pointer.zig#fn_pointer

:::

## å¤šé¡¹æŒ‡é’ˆ

å¤šé¡¹æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„å…ƒç´ ï¼Œä½†å…¶æ•°é‡åœ¨ç¼–è¯‘æœŸæ˜¯æœªçŸ¥çš„ã€‚

å¤šé¡¹æŒ‡é’ˆçš„ç±»å‹ä¸º `[*]T`ï¼Œå…¶ä¸­ `T` æ˜¯æ‰€æŒ‡å‘çš„æ•°æ®ç±»å‹ï¼Œä¸” `T` çš„å¤§å°å¿…é¡»æ˜¯æ˜ç¡®çš„ï¼ˆè¿™æ„å‘³ç€å®ƒä¸èƒ½æ˜¯ [`anyopaque`](https://ziglang.org/documentation/master/#toc-C-Type-Primitives) æˆ–å…¶ä»–[ä¸é€æ˜ç±»å‹](https://ziglang.org/documentation/master/#opaque)ï¼‰ã€‚

å®ƒæ”¯æŒä»¥ä¸‹å‡ ç§æ“ä½œï¼š

- ç´¢å¼•è¯­æ³• `ptr[i]`
- åˆ‡ç‰‡è¯­æ³• `ptr[start..end]` å’Œ `ptr[start..]`
- æŒ‡é’ˆè¿ç®— `ptr + int`, `ptr - int`
- æŒ‡é’ˆå‡æ³• `ptr - ptr`

<<<@/code/release/pointer.zig#multi_pointer

:::info ğŸ…¿ï¸ æç¤º

æ•°ç»„å’Œåˆ‡ç‰‡éƒ½ä¸æŒ‡é’ˆæœ‰ç´§å¯†çš„è”ç³»ã€‚

`*[N]T`ï¼šè¿™æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„å•é¡¹æŒ‡é’ˆï¼Œæ•°ç»„çš„é•¿åº¦ä¸º Nã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæŒ‡å‘ä¸€ä¸ªåŒ…å« N ä¸ªå…ƒç´ æ•°ç»„çš„æŒ‡é’ˆã€‚

æ”¯æŒè¿™äº›è¯­æ³•ï¼š

- ç´¢å¼•è¯­æ³•ï¼š`array_ptr[i]`
- åˆ‡ç‰‡è¯­æ³•ï¼š`array_ptr[start..end]`
- `len` å±æ€§ï¼š`array_ptr.len`
- æŒ‡é’ˆå‡æ³•ï¼š`array_ptr - array_ptr`

`[]T`ï¼šè¿™æ˜¯åˆ‡ç‰‡ã€‚å®ƒæ˜¯ä¸€ä¸ªâ€œèƒ–æŒ‡é’ˆâ€ï¼Œå†…éƒ¨åŒ…å«ä¸€ä¸ª `[*]T` ç±»å‹çš„æŒ‡é’ˆå’Œä¸€ä¸ªé•¿åº¦å€¼ã€‚

æ”¯æŒè¿™äº›è¯­æ³•ï¼š

- ç´¢å¼•è¯­æ³•ï¼š`slice[i]`
- åˆ‡ç‰‡è¯­æ³•ï¼š`slice[start..end]`
- `len` å±æ€§ï¼š`slice.len`

æ•°ç»„æŒ‡é’ˆçš„ç±»å‹æœ¬èº«å°±åŒ…å«äº†é•¿åº¦ä¿¡æ¯ï¼Œè€Œåˆ‡ç‰‡åˆ™åœ¨è¿è¡Œæ—¶å­˜å‚¨å…¶é•¿åº¦ã€‚æ•°ç»„æŒ‡é’ˆå’Œåˆ‡ç‰‡çš„é•¿åº¦éƒ½å¯ä»¥é€šè¿‡ `len` å±æ€§æ¥è·å–ã€‚

:::details ç¤ºä¾‹

<<<@/code/release/pointer.zig#array_and_slice

:::

### å“¨å…µæŒ‡é’ˆï¼ˆæ ‡è®°ç»ˆæ­¢æŒ‡é’ˆï¼‰

:::info

å…¶æœ¬è´¨æ˜¯ä¸ºäº†å…¼å®¹ C è¯­è¨€ä¸­ä»¥ `\0` ä½œä¸ºç»“å°¾çš„å­—ç¬¦ä¸²ã€‚

:::

å“¨å…µæŒ‡é’ˆä¸å“¨å…µæ•°ç»„ç±»ä¼¼ã€‚æˆ‘ä»¬ä½¿ç”¨ `[*:x]T` è¯­æ³•æ¥å®šä¹‰å“¨å…µæŒ‡é’ˆã€‚è¿™ç§æŒ‡é’ˆé€šè¿‡ä¸€ä¸ªç‰¹å®šçš„â€œå“¨å…µâ€å€¼æ¥æ ‡è®°å…¶è¾¹ç•Œã€‚

å…¶é•¿åº¦ç”±å“¨å…µå€¼ `x` çš„ä½ç½®å†³å®šï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æä¾›äº†é’ˆå¯¹ç¼“å†²åŒºæº¢å‡ºå’Œè¿‡åº¦è¯»å–çš„ä¿æŠ¤ã€‚

:::details ç¤ºä¾‹

æˆ‘ä»¬æ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸ªç¤ºä¾‹ã€‚è¯¥ç¤ºä¾‹åˆ©ç”¨äº† Zig ä¸ C æ— ç¼äº¤äº’çš„ç‰¹æ€§ï¼Œå› æ­¤ï¼Œå¦‚æœä½ å¯¹ C äº¤äº’ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡ã€‚

<<<@/code/release/pointer.zig#st_pointer

ä»¥ä¸Šä»£ç ç¼–è¯‘éœ€è¦é¢å¤–é“¾æ¥ libcï¼Œä½ åªéœ€è¦åœ¨ä½ çš„ `build.zig` ä¸­æ·»åŠ  `exe.linkLibC();` å³å¯ã€‚

:::

## å¤šé¡¹æŒ‡é’ˆå’Œå•é¡¹æŒ‡é’ˆåŒºåˆ«

æœ¬èŠ‚ä¸“é—¨è§£é‡Šå•é¡¹æŒ‡é’ˆå’Œå¤šé¡¹æŒ‡é’ˆçš„åŒºåˆ«ã€‚

å…ˆåˆ—å‡ºä»¥ä¸‹ç±»å‹ï¼š

- `[4] const u8`

è¯¥ç±»å‹ä»£è¡¨ä¸€ä¸ªé•¿åº¦ä¸º 4 çš„æ•°ç»„ï¼Œæ•°ç»„å†…çš„å…ƒç´ ç±»å‹ä¸º `const u8`ã€‚

- `[] const u8`

è¯¥ç±»å‹ä»£è¡¨ä¸€ä¸ªåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡å†…å…ƒç´ ç±»å‹ä¸º `const u8`ã€‚

- `*[4] const u8`

è¯¥ç±»å‹ä»£è¡¨ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¯¥åœ°å€å­˜å‚¨ç€ä¸€ä¸ªé•¿åº¦ä¸º 4 çš„æ•°ç»„ï¼Œæ•°ç»„å†…çš„å…ƒç´ ç±»å‹ä¸º `const u8`ã€‚

- `*[] const u8`

è¯¥ç±»å‹ä»£è¡¨ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¯¥åœ°å€å­˜å‚¨ç€ä¸€ä¸ªåˆ‡ç‰‡ã€‚

- `[*] const u8`

è¯¥ç±»å‹ä»£è¡¨ä¸€ä¸ªæŒ‡å‘å†…å­˜åœ°å€çš„æŒ‡é’ˆï¼Œè¯¥åœ°å€å­˜å‚¨äº†ä¸€ä¸ªæˆ–å¤šä¸ª `const u8` ç±»å‹çš„å…ƒç´ ï¼Œä½†å…¶æ•°é‡æ˜¯æœªçŸ¥çš„ã€‚

å…¶ä¸­ `[*] const u8` å¯ä»¥çœ‹ä½œæ˜¯ C ä¸­çš„ `*const char`ã€‚è¿™ç±»ä¼¼äº C è¯­è¨€ä¸­çš„ `const char*`ï¼Œå› ä¸ºåœ¨ C ä¸­ï¼Œä¸€ä¸ªæ™®é€šæŒ‡é’ˆæ—¢å¯ä»¥æŒ‡å‘å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚Zig åˆ™é€šè¿‡ `[*]T` è¿™ç§ä¸“é—¨çš„è¯­æ³•æ¥æ˜ç¡®è¡¨ç¤ºæŒ‡å‘å¤šä¸ªå…ƒç´ çš„æƒ…å†µï¼Œé¿å…äº†æ­§ä¹‰ã€‚

## æŒ‡é’ˆå’Œæ•´æ•°äº’è½¬

[`@ptrFromInt`](https://ziglang.org/documentation/master/#ptrFromInt) å¯ä»¥å°†ä¸€ä¸ªæ•´æ•°å€¼å½“ä½œå†…å­˜åœ°å€æ¥åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œ [`@intFromPtr`](https://ziglang.org/documentation/master/#intFromPtr) å¯ä»¥å°†æŒ‡é’ˆè½¬æ¢ä¸ºæ•´æ•°ï¼š

<<<@/code/release/pointer.zig#ptr2int

## æŒ‡é’ˆå¼ºåˆ¶è½¬æ¢

å†…ç½®å‡½æ•° [`@ptrCast`](https://ziglang.org/documentation/master/#ptrCast) å¯ä»¥å°†ä¸€ä¸ªæŒ‡é’ˆçš„ç±»å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œå³æ”¹å˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•°æ®ç±»å‹ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”å½“å°½é‡é¿å…ä½¿ç”¨ `@ptrCast`ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆï¼Œé€šè¿‡å®ƒè¿›è¡Œçš„åŠ è½½å’Œå­˜å‚¨æ“ä½œå¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥æ£€æµ‹çš„éæ³•è¡Œä¸ºã€‚

<<<@/code/release/pointer.zig#ptr_cast

## é¢å¤–ç‰¹æ€§

ä»¥ä¸‹æ˜¯æŒ‡é’ˆçš„ä¸€äº›é¢å¤–ç‰¹æ€§ã€‚åˆå­¦è€…å¯ä»¥æš‚æ—¶è·³è¿‡è¿™äº›å†…å®¹ï¼Œåœ¨éœ€è¦æ—¶å†æ¥å­¦ä¹ ã€‚

### `volatile`

> å¦‚æœä½ ä¸çŸ¥é“æŒ‡é’ˆæ“ä½œçš„â€œå‰¯ä½œç”¨â€æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡æœ¬èŠ‚ï¼Œåœ¨éœ€è¦æ—¶å†æ¥æŸ¥çœ‹ã€‚

å¯¹æŒ‡é’ˆçš„æ“ä½œé€šå¸¸è¢«å‡å®šä¸ºæ²¡æœ‰å‰¯ä½œç”¨ã€‚ä½†å¦‚æœå­˜åœ¨å‰¯ä½œç”¨ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨å†…å­˜æ˜ å°„è¾“å…¥è¾“å‡ºï¼ˆMemory Mapped Input/Outputï¼‰æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ `volatile` å…³é”®å­—æ¥ä¿®é¥°æŒ‡é’ˆã€‚

åœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼Œ`volatile` ç¡®ä¿äº†å¯¹ `mmio_ptr` çš„æ¯æ¬¡è®¿é—®éƒ½ä¼šç›´æ¥è¯»å†™å†…å­˜ï¼Œè€Œä¸æ˜¯ä»ç¼“å­˜ä¸­è¯»å–ã€‚å½“ä¸ç¡¬ä»¶äº¤äº’æ—¶ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°†å€¼ç¼“å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œè€Œ `volatile` åˆ™å¼ºåˆ¶æ¯æ¬¡éƒ½ä»å†…å­˜ä¸­è¯»å–ï¼Œä»¥ç¡®ä¿â€œå‰¯ä½œç”¨â€èƒ½å¤Ÿæ­£ç¡®è§¦å‘ï¼Œå¹¶ä¿è¯äº†ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚

<<<@/code/release/pointer.zig#volatile

æœ¬èŠ‚ä»…ç®€è¦ä»‹ç»ï¼Œå¦‚æœè¦äº†è§£æ›´å¤šï¼Œä½ å¯èƒ½éœ€è¦æŸ¥çœ‹[å®˜æ–¹æ–‡æ¡£](https://ziglang.org/documentation/master/#toc-volatile)ã€‚

### å¯¹é½

> å¦‚æœä½ ä¸çŸ¥é“å†…å­˜å¯¹é½çš„å«ä¹‰ï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡æœ¬èŠ‚ï¼Œåœ¨éœ€è¦æ—¶å†æ¥æŸ¥çœ‹ã€‚

æ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯¹é½æ–¹å¼ï¼Œå³ä¸€ä¸ªå­—èŠ‚æ•°ã€‚å½“ä»å†…å­˜ä¸­åŠ è½½æˆ–å­˜å‚¨è¯¥ç±»å‹çš„å€¼æ—¶ï¼Œå…¶å†…å­˜åœ°å€å¿…é¡»æ˜¯è¯¥å­—èŠ‚æ•°çš„æ•´æ•°å€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `@alignOf` æ¥è·å–ä»»ä½•ç±»å‹çš„å†…å­˜å¯¹é½å¤§å°ã€‚

å†…å­˜å¯¹é½å¤§å°å–å†³äº CPU æ¶æ„ï¼Œä½†å§‹ç»ˆæ˜¯ 2 çš„å¹‚ï¼Œå¹¶ä¸”å°äº `1 << 29`ã€‚

:::info

`align(0)` è¡¨ç¤ºæ— éœ€å¯¹é½ï¼Œè¿™åœ¨é«˜æ€§èƒ½ã€å†…å­˜ç´§è¿«çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚
å‚è€ƒï¼š[allow align(0) on struct fields](https://github.com/ziglang/zig/issues/3802)

:::

åœ¨ Zig ä¸­ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿå…·æœ‰å¯¹é½å€¼ã€‚å¦‚æœè¯¥å€¼ç­‰äºå…¶åŸºç¡€ç±»å‹çš„å¯¹é½æ–¹å¼ï¼Œåˆ™å¯ä»¥ä»ç±»å‹å£°æ˜ä¸­çœç•¥å®ƒï¼š

<<<@/code/release/pointer.zig#align

:::info ğŸ…¿ï¸ æç¤º

å’Œ `*i32` ç±»å‹å¯ä»¥éšå¼è½¬æ¢ä¸º `*const i32` ç±»å‹ç±»ä¼¼ï¼Œå…·æœ‰æ›´ä¸¥æ ¼ï¼ˆæ›´å¤§ï¼‰å¯¹é½è¦æ±‚çš„æŒ‡é’ˆå¯ä»¥éšå¼è½¬æ¢ä¸ºå¯¹é½è¦æ±‚æ›´å®½æ¾ï¼ˆæ›´å°ï¼‰çš„æŒ‡é’ˆï¼Œä½†åä¹‹åˆ™ä¸è¡Œã€‚

å¦‚æœæœ‰ä¸€ä¸ªæŒ‡é’ˆæˆ–åˆ‡ç‰‡çš„å¯¹é½æ–¹å¼è¾ƒå°ï¼Œä½†æˆ‘ä»¬ç¡®å®šå®ƒå®é™…ä¸Šæ»¡è¶³æ›´ä¸¥æ ¼çš„å¯¹é½è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ `@alignCast` å°†å…¶è½¬æ¢æˆå…·æœ‰æ›´ä¸¥æ ¼å¯¹é½çš„æŒ‡é’ˆç±»å‹ï¼Œä¾‹å¦‚ï¼š`@as([]align(4) u8, @alignCast(slice4))`ã€‚è¿™ä¸ªè½¬æ¢åœ¨è¿è¡Œæ—¶æ²¡æœ‰å¼€é”€ï¼Œä½†ä¼šæ’å…¥ä¸€ä¸ªå®‰å…¨æ£€æŸ¥ã€‚

:::details ç¤ºä¾‹

<<<@/code/release/pointer.zig#align_cast

:::

å¦‚æœæœ‰ä¸€ä¸ªæŒ‡é’ˆæˆ–åˆ‡ç‰‡ï¼Œå®ƒçš„å¯¹é½è¦æ±‚å¾ˆå®½æ¾ï¼Œä½†æˆ‘ä»¬çŸ¥é“å®ƒå®é™…ä¸Šæœ‰ä¸€ä¸ªæ›´ä¸¥æ ¼çš„å¯¹é½æ–¹å¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ [`@alignCast`](https://ziglang.org/documentation/master/#alignCast) æ¥è·å¾—ä¸€ä¸ªå¯¹é½è¦æ±‚æ›´ä¸¥æ ¼çš„æŒ‡é’ˆã€‚è¿™åœ¨è¿è¡Œæ—¶æ²¡æœ‰å¼€é”€ï¼Œä½†ä¼šé¢å¤–åŠ å…¥ä¸€ä¸ª[å®‰å…¨æ£€æŸ¥](https://ziglang.org/documentation/master/#Incorrect-Pointer-Alignment)ï¼š

> ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ˜¯é”™è¯¯çš„ï¼Œä¸ä¼šè¢«æ­£å¸¸æ‰§è¡Œï¼š

```zig
const std = @import("std");

test "pointer alignment safety" {
    var array align(4) = [_]u32{ 0x11111111, 0x11111111 };
    const bytes = std.mem.sliceAsBytes(array[0..]);
    try std.testing.expect(foo(bytes) == 0x11111111);
}
fn foo(bytes: []u8) u32 {
    const slice4 = bytes[1..5];
    const int_slice = std.mem.bytesAsSlice(u32, @as([]align(4) u8, @alignCast(slice4)));
    return int_slice[0];
}
```

```sh
$ zig test test_incorrect_pointer_alignment.zig
1/1 test_incorrect_pointer_alignment.test.pointer alignment safety...thread 958173 panic: incorrect alignment
/home/ci/actions-runner/_work/zig-bootstrap/zig/doc/langref/test_incorrect_pointer_alignment.zig:10:68: 0x1048962 in foo (test)
    const int_slice = std.mem.bytesAsSlice(u32, @as([]align(4) u8, @alignCast(slice4)));
                                                                   ^
/home/ci/actions-runner/_work/zig-bootstrap/zig/doc/langref/test_incorrect_pointer_alignment.zig:6:31: 0x104880f in test.pointer alignment safety (test)
    try std.testing.expect(foo(bytes) == 0x11111111);
                              ^
/home/ci/actions-runner/_work/zig-bootstrap/out/host/lib/zig/compiler/test_runner.zig:214:25: 0x10efab9 in mainTerminal (test)
        if (test_fn.func()) |_| {
                        ^
/home/ci/actions-runner/_work/zig-bootstrap/out/host/lib/zig/compiler/test_runner.zig:62:28: 0x10e7ead in main (test)
        return mainTerminal();
                           ^
/home/ci/actions-runner/_work/zig-bootstrap/out/host/lib/zig/std/start.zig:647:22: 0x10e7430 in posixCallMainAndExit (test)
            root.main();
                     ^
/home/ci/actions-runner/_work/zig-bootstrap/out/host/lib/zig/std/start.zig:271:5: 0x10e6ffd in _start (test)
    asm volatile (switch (native_arch) {
    ^
???:?:?: 0x0 in ??? (???)
error: the following test command crashed:
/home/ci/actions-runner/_work/zig-bootstrap/out/zig-local-cache/o/608e4a8451ecb0974638281c85927599/test --seed=0x9bc870fd
```

### é›¶æŒ‡é’ˆ

å°†é›¶åœ°å€è½¬æ¢ä¸ºæŒ‡é’ˆé€šå¸¸æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆ[Pointer Cast Invalid Null](https://ziglang.org/documentation/master/#Pointer-Cast-Invalid-Null)ï¼‰ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸ºæŒ‡é’ˆç±»å‹æ·»åŠ  `allowzero` ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆå€¼ä¸ºé›¶çš„æŒ‡é’ˆå°±æˆä¸ºåˆæ³•çš„äº†ã€‚

:::warning å…³äºé›¶æŒ‡é’ˆçš„ä½¿ç”¨

è¯·åªåœ¨ç›®æ ‡ OS ä¸º `freestanding` æ—¶ä½¿ç”¨é›¶æŒ‡é’ˆã€‚å¦‚æœæƒ³è¡¨ç¤º `null` æŒ‡é’ˆï¼Œè¯·ä½¿ç”¨[å¯é€‰ç±»å‹](/basic/optional_type)ã€‚

:::

<<<@/code/release/pointer.zig#zero_pointer

### ç¼–è¯‘æœŸ

åªè¦ä»£ç ä¸ä¾èµ–äºè¿è¡Œæ—¶æ‰ç¡®å®šçš„å†…å­˜å¸ƒå±€ï¼ŒæŒ‡é’ˆä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æœŸä½¿ç”¨ã€‚

<<<@/code/release/pointer.zig#comptime_pointer

åªè¦æŒ‡é’ˆä»æœªè¢«è§£å¼•ç”¨ï¼ŒZig å°±èƒ½åœ¨ `comptime` ä»£ç ä¸­ä¿ç•™å…¶å†…å­˜åœ°å€ï¼š

<<<@/code/release/pointer.zig#comp_pointer
